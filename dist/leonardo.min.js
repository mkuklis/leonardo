(function(){function g(){this.elements=[],this.events={},this.flags={}}var a=this,b=a.document,c="mousedown mouseup mousemove touchstart touchmove touchend click".split(" "),d={mouseover:"mousemove",mouseout:"mousemove",dragstart:"mousedown",dragmove:"mousemove",dragend:"mouseup"},e="createTouch"in b,f={mousemove:function(a,b,c,d){if(a.flags.dragging)a.attr({x:b.x-a.attrs.dx,y:b.y-a.attrs.dy});else if(!a.flags.over&&L.isPointInRange(a,b)){var e=this.flags.mouseover;if(!e||c>e||this.flags.dragging){if(c>e){var f=d[e];f.mouseout&&f.mouseout.call(f),f.flags.over=!1}return a.mouseover&&a.mouseover.call(a),this.flags.mouseover=c,a.flags.over=!0,!0}}else a.flags.over&&!L.isPointInRange(a,b)&&(a.flags.over=!1,a.mouseout&&a.mouseout.call(a),delete this.flags.mouseover)},mousedown:function(a,b){if(L.isPointInRange(a,b))return a.dragstart?(a.flags.dragging=!0,this.flags.dragging=!0,a.toFront(),a.attr({dx:b.x-a.attrs.x,dy:b.y-a.attrs.y},{silent:!0}),L.is("Function",a.dragstart)&&a.dragstart.call(a)):a.mousedown&&a.mousedown.call(a),!0},mouseup:function(a,b){a.dragend&&a.flags.dragging?(a.flags.dragging=!1,this.flags.dragging=!1,L.is("Function",a.dragend)&&a.dragend.call(a)):a.mouseup&&a.mouseup.call(a)},click:function(a,b){if(L.isPointInRange(a,b))return a.click&&a.click.call(a),!0},touchstart:function(a,b){if(L.isPointInRange(a,b))return a.touchstart&&a.touchstart.call(a),!0},touchmove:function(){},touchend:function(){}};this.Leonardo=this.L=function(){var a=new g;return a.canvas=L.createCanvas.apply(a,arguments),a.ctx=a.canvas.getContext("2d"),a},L.version=.1,g.prototype={circle:function(a,b,c,d){var e={x:a||0,y:b||0,r:c||0},f=L.E("circle",L.extend(e,d),this);return f.draw(),f},rect:function(a,b,c,d,e,f){var g={x:a||0,y:b||0,w:c||0,h:d||0,r:e||0},h=L.E("rect",L.extend(g,f),this);return h.draw(),h},path:function(a,b){if(L.is("Array",a))var a={path:a};var b=b||{},c=L.E("path",a,this,b);return b.silent||c.draw(),c},image:function(a,b,c,d,e,f){var g={src:a,x:b||0,y:c||0,w:d||0,h:e||0},h=L.E("image",L.extend(g,f),this);return h.draw(),h},redraw:function(){this.clear(),this.elements.forEach(function(a){a.draw()})},reset:function(){var a=this.events;c.forEach(function(b){a[b]&&a[b].splice(0,a[b].length)}),this.elements.splice(0,this.elements.length),this.flags={},this.clear()},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath()},getPos:function(a){var b,c;return a.touches?(b=a.touches[0].pageX-this.canvas.offsetLeft,c=a.touches[0].pageY-this.canvas.offsetLeft):(b=a.pageX-this.canvas.offsetLeft,c=a.pageY-this.canvas.offsetTop),{x:b,y:c}},bind:function(a,b){var c=this.events,a=d[a]?d[a]:a;this.events[a]||(this.events[a]=[],this.canvas.addEventListener(a,L.proxy(function(b){this[a](b),b.preventDefault()},this),!1)),(c[a].length==0||c[a].indexOf(b)==-1)&&c[a].push(b)},unbind:function(a,b){var c=this.events[a];c.forEach(function(d,e){d==b&&(delete b[a],c.splice(e,1))})}},L.toString=function(){return"Leonardo ver. "+L.version},L.proxy=function(a,b){return function(){a.apply(b,arguments)}},L.createCanvas=function(){var a,c=arguments;return c.length==4?L.isAllN(c)&&(a=b.createElement("canvas"),a.style.position="absolute",a.style.left=c[0]+"px",a.style.top=c[1]+"px",a.width=c[2],a.height=c[3],b.body.appendChild(a)):L.is("String",c[0])&&(a=b.getElementById(c[0])),a},L.isPointInRange=function(a,b){if(a.type=="circle"){var c=Math.pow(a.attrs.x-b.x,2)+Math.pow(a.attrs.y-b.y,2);return c<=a.attrs.r*a.attrs.r}var d=a.coords;for(var e=!1,f=-1,g=d.length,h=g-1;++f<g;h=f)(d[f][1]<=b.y&&b.y<d[h][1]||d[h][1]<=b.y&&b.y<d[f][1])&&b.x<(d[h][0]-d[f][0])*(b.y-d[f][1])/(d[h][1]-d[f][1])+d[f][0]&&(e=!e);return e},L.extend=function(a){return[].slice.call(arguments,1).forEach(function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},L.is=function(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return b!==undefined&&b!==null&&c===a},L.isAllN=function(a){for(var b=0,c=a.length;b<c;b++)if(!L.is("Number",a[b]))return!1;return!0},L.uuid=function j(a){return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+ -1e3+ -4e3+ -8e3+ -1e11).replace(/[018]/g,j)},L.rad=function(a){return a%360*Math.PI/180},L.deg=function(a){return a*180/Math.PI%360};for(var h=0,i=c.length;h<i;h++)(function(a){g.prototype[a]=function(b){var c=this.getPos(b),d=this.events[a];for(var e=d.length-1;e>=0;e--){var g=d[e],h=f[a].call(this,g,c,e,d);if(h)return!0}}})(c[h])}).call(this),function(a){a.C={rgbRegex:/^rgb\(([0-255]{1,3}),\s*([0-255]{1,3}),\s*([0-255]{1,3})\)$/ig,singleHexRegex:/^([a-f0-9])([a-f0-9])([a-f0-9])$/i,tripleHexRegex:/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i,hex2rgb:function(a){var a=a[0]=="#"?a.substr(1):a;if(a.length==3){var b=this.singleHexRegex.exec(a).slice(1);for(var c=0;c<3;c++)a+=b[c]}var d=this.tripleHexRegex.exec(a).slice(1);return{r:parseInt(d[0],16),g:parseInt(d[1],16),b:parseInt(d[2],16)}},txt2rgb:function(a){var b=d.getElementById("txt2rgb");return b||(b=d.createElement("div"),attr=d.createAttribute("id"),attr.value="txt2rgb",b.setAttributeNode(attr),b.style.display="none",d.body.appendChild(b)),b.style.color=a,ww.getComputedStyle(b).color},rgb2rgba:function(a,b){var a=this.rgbRegex.exec(color);return a&&a.length==4?"rgba("+a[1]+", "+a[2]+", "+a[3]+", "+b+")":a},toColor:function(a,b){if(typeof b!="undefined"){if(a.indexOf("rgba")>-1)return a;if(a.charAt()==="#"){var c=this.hex2rgb(a);return"rgba("+c.r+", "+c.g+", "+c.b+", "+b+")"}return a.indexOf("rgb")>-1?this.rgb2rgba(a):this.rgb2rgba(this.txt2rgb(a))}return a}}}(Leonardo),function(a){function b(){this.reset()}b.prototype={reset:function(){this.m=[[1,0,0],[0,1,0],[0,0,1]]},add:function(a,b,c,d,e,f){var g=[[],[],[]],h=[[a,c,e],[b,d,f],[0,0,1]],i,j,k,l;for(i=0;i<3;i++)for(j=0;j<3;j++){l=0;for(k=0;k<3;k++)l+=this.m[i][k]*h[k][j];g[i][j]=l}this.m=g},translate:function(a,b){this.add(1,0,0,1,a,b)},scale:function(a,b,c,d){b==null&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},rotate:function(b,c,d){b=a.rad(b),c=c||0,d=d||0;var e=Math.cos(b).toFixed(9),f=Math.sin(b).toFixed(9);this.add(e,f,-f,e,c,d),this.add(1,0,0,1,-c,-d)},x:function(a,b){return a*this.m[0][0]+b*this.m[0][1]+this.m[0][2]},y:function(a,b){return a*this.m[1][0]+b*this.m[1][1]+this.m[1][2]},xy:function(a,b){return[this.x(a,b),this.y(a,b)]}},a.matrix=function(){return new b},a.Matrix=b}(Leonardo),function(a){var b="mouseover mouseout mousedown mouseup click".split(" "),d={M:function(a){this.ctx.moveTo(a[0],a[1]),this.updateBbox({x:a[0],y:a[1]})},L:function(a){for(var b=0,c=a.length;b<c;b+=2)this.ctx.lineTo(a[b],a[b+1]),this.updateBbox({x:a[b],y:a[b+1]})},V:function(a){this.ctx.lineTo(this.bbox.x,a)},H:function(a){this.ctx.lineTo(a,this.bbox.y)},Q:function(a){for(var b=0,c=a.length;b<c;b+=4)this.ctx.quadraticCurveTo(a[b],a[b+1],a[b+2],a[b+3]),this.updateBbox({x:a[b+2],y:a[b+3]})},B:function(a){for(var b=0,c=a.length;b<c;b+=6)this.ctx.bezierCurveTo(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5]),this.updateBbox({x:a[b+4],y:a[b+5]})}},e={rotate:function(a){this.m.rotate(a.angle),this.ctx.rotate(a.angle*Math.PI/180)},scale:function(a){this.m.scale(a.sx,a.sy),this.ctx.scale(a.sx,a.sy)}},f={circle:function(a){this.ctx.arc(a.x-a.dx,a.y-a.dy,a.r,0,Math.PI*2,!0),this.updateBbox({x:a.x-a.dx-a.r,y:a.y-a.dy-a.r,w:2*a.r,h:2*a.r})},rect:function(a){this.ctx.rect(a.tx,a.ty,a.w,a.h),this.updateBbox({x:a.tx,y:a.ty,w:a.w,h:a.h})},path:function(){this.attrs.path.forEach(this.processPath,this)},image:function(a){this.processImage(),this.updateBbox({x:a.x,y:a.y,w:a.w,h:a.h})}},g=function(b,c,d,e){if(!(this instanceof g))return new g(b,c,d,e);this.type=b,this.attrs=c,this.attrs.dx=0,this.attrs.dy=0,this.flags={},this.l=d,this.ctx=this.l.ctx,this.m=new a.Matrix,this.t=[],this.bbox={x:Infinity,y:Infinity,w:0,h:0};var e=e||{};e.back?this.l.elements.unshift(this):this.l.elements.push(this),this.updateCoords(),this.id=a.uuid()};g.prototype={constructor:g,attr:function(b,c){if(a.is("String",b))return this.attrs[b];if(a.is("Array",b)){var d=[];for(var e=0,f=b.length;e<f;e++)d.push(this.attrs[b[e]]);return d}var c=c||{};for(key in b)this.attrs[key]=b[key];return c.silent||this.redraw(),this},redraw:function(){this.l.redraw()},draw:function(){var b=this.attrs;this.ctx.save(),this.ctx.beginPath(),b.fill&&(this.ctx.fillStyle=this.createStyle()),b.stroke=b.stroke||"#000000",this.ctx.strokeStyle=a.C.toColor(b.stroke,b["stroke-opacity"]),this.ctx.lineWidth=b["stroke-width"]||1,this.t.length&&this.transform(),this.updateCoords(),f[this.type]&&f[this.type].call(this,b),b.fill&&this.ctx.fill(),b.text&&this.processText(),this.ctx.closePath(),this.ctx.restore()},createStyle:function(){var b=this.attrs;return g.isGradient(b.fill)?this.parseGradient(b.fill):a.C.toColor(b.fill,b.opacity)},processText:function(){var a=this.attrs,b=a["text-position"]||"center:middle",c=a["font-color"]||"rgba(0,0,0,1.0)",d=a.font||"10px sans-serif",e=b.split(":");e.length==1&&e.push("middle"),this.ctx.textAlign=aligns[0],this.ctx.textBaseline=aligns[1],this.ctx.fillStyle=c,this.ctx.font=d,this.ctx.fillText(a.text,a.x-a.dx,a.y-a.dy)},processImage:function(){var b=this.attrs;this.img?this.ctx.drawImage(this.img,b.x,b.y,b.w,b.h):(this.img=new Image,this.img.onload=a.proxy(function(){this.ctx.drawImage(this.img,b.x,b.y,b.w,b.h)},this),this.img.src=b.src)},parseGradient:function(a){var b=a.split(":"),c=this.attrs,d=b.shift(),e=b[b.length-1],f,g;e.indexOf("-")==-1&&(f=b.pop().split(",")),d==="r"?(f=f?f:[c.x-c.dx,c.y-c.dy,0,c.x-c.dx,c.y-c.dy,c.r],g=this.ctx.createRadialGradient.apply(this.ctx,f)):(f=f?f:[c.x,c.y,c.w,c.h],g=this.ctx.createLinearGradient.apply(this.ctx,f));for(var h=0,i=b.length;h<i;h++){var j=b[h].split("-");g.addColorStop(j[0],C.toColor(j[1]))}return g},drag:function(a,b,c){return this.bind("dragstart",a||!0),this.bind("dragmove",b||!0),this.bind("dragend",c||!0),this},touch:function(a,b,c){return this.bind("touchstart",a||!0),this.bind("touchmove",b||!0),this.bind("touchend",c||!0),this},bind:function(a,b){return this[a]=b,this.l.bind(a,this),this},unbind:function(a,b){return this[a]=b,this.l.unbind(a,this),this},toFront:function(){var a=this.l.elements.indexOf(this),c=this.l.elements;a<c.length-1&&(c.splice(a,1),c.push(this),b.forEach(function(a){var b=this.l.events[a];if(b){var c=b.indexOf(this);c>-1&&c!=b.length-1&&(b.splice(c,1),b.push(this))}},this),this.l.flags.mouseover=a,this.redraw())},toBack:function(){var a=this.l.elements.indexOf(this),b=this.l.elements;b.splice(a,1),b.unshift(this),this.redraw()},processPath:function(a){for(c in a)d[c].call(this,a[c])},rotate:function(a,b,c){var d=this.attrs;return b==undefined&&(b=d.w/2,c=d.h/2),d.cx=b,d.cy=c,d.tx=-b,d.ty=-c,this.t.push({c:"rotate",angle:a,cx:b,cy:c}),this.redraw(),this},scale:function(a,b,c,d){var e=this.attrs;return c==undefined&&(c=e.w/2,d=e.h/2),e.cx=c,e.cy=d,e.tx=-c,e.ty=-d,this.t.push({c:"scale",sx:a,sy:b,cx:c,cy:d}),this.redraw(),this},transform:function(){var a=this.attrs;this.m.reset(),this.m.translate(a.x+a.cx,a.y+a.cy),this.ctx.translate(a.x+a.cx,a.y+a.cy),this.t.forEach(function(a){e[a.c].call(this,a)},this)},updateBbox:function(a){var b=this.bbox;a.w&&a.h?this.bbox=a:a.x&&a.y&&(a.x<b.x&&(b.x=a.x),a.x>b.x+b.w&&(b.w=a.x-b.x),a.y<b.y&&(b.y=a.y),a.y>b.y+b.h&&(b.h=a.y-b.y))},getBbox:function(){return this.bbox},updateCoords:function(){var a=this.attrs;if(this.t.length)this.coords=[[a.tx,a.ty],[a.tx+a.w,a.ty],[a.tx+a.w,a.ty+a.h],[a.tx,a.ty+a.h]],this.coords.forEach(function(a,b){this.coords[b]=this.m.xy(a[0],a[1])},this);else{var b=a.x,c=a.y,d=a.w,e=a.h;a.tx=b,a.ty=c,this.coords=[[b,c],[b+d,c],[b+d,c+e],[b,c+e]]}}},g.isGradient=function(a){return a[0]=="r"||a[0]=="l"},a.E=g;for(var h=0,i=b.length;h<i;h++)(function(a){g.prototype[a]=function(b){return this.bind(a,b),this},g.prototype["un"+a]=function(b){return this.unbind(a,b),this}})(b[h])}(Leonardo)